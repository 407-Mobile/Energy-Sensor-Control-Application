<html>

<head>
    <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
        <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.1/jquery.mobile-1.4.1.min.css"/>
        <link rel="stylesheet" href="css/index.css">
        <link rel="stylesheet" href="css/custom.css">
        <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
        <script src="http://code.jquery.com/mobile/1.4.1/jquery.mobile-1.4.1.min.js"></script>
        <script src="http://maps.googleapis.com/maps/api/js?sensor=true"></script>
        <script src="http://www.parsecdn.com/js/parse-1.2.18.min.js"></script>
</head>

<body> 
    
<div id="loginPage" data-role="page" data-theme="c">

    <div data-theme="c" data-role="header" id="header">
                <strong id="WINGS">WINGS-Energy Control</strong>
                <img src="img/router.png">
     </div>

    <div data-role="content" data-theme="c">    

        <form id="loginForm" data-theme="c">
        <div data-role="fieldcontain" class="ui-hide-label" data-theme="c">
            <label for="email">Email:</label>
            <input type="text" name="email" id="email" value="" placeholder="Email" />
        </div>

        <div data-role="fieldcontain" class="ui-hide-label" data-theme="c"> 
            <label for="password">Password:</label>
            <input type="password" name="password" id="password" value="" placeholder="Password" />
        </div>

        </form>
        <button data-role="button" id="loginBtn" data-theme="c">Login</button>
    </div>

    <div data-theme="c" data-role="footer">
                <h3>
                    UW-Madison
                </h3>
            </div>
</div>

<div data-role="page" data-control-title="Routers" id="devices" data-theme="c">
    <div data-theme="c" data-role="header" id="header">
        <button data-role="button" data-inline="true" class="ui-btn-left" id="btnLogout">
            Logout
        </button>
        <h5>
            Energy Control
        </h5>
    </div>
    <div data-role="content" data-theme="c">
        <ul id="sensor_list" data-role="listview" data-divider-theme="c" data-inset="false">
            <li data-theme="c">
            </li>
        </ul>
    </div>
    <div data-theme="c" data-role="footer">
        <h3>
            UW-Madison
        </h3>
    </div>
</div>

<div data-role="page" data-control-title="Routers" id="sensor_settings" data-theme="c">
    <div data-theme="c" data-role="header" id="header">
        <button data-role="button" data-inline="true" class="ui-btn-left" id="btnBacktoDevices">
            Back
        </button>
        <h5>
            Sensor Settings
        </h5>
    </div>
    <div data-role="content" data-theme="c">
        <ul data-role="listview" data-divider-theme="c" data-inset="false" id="set_sched">
            <li data-theme="c">
                <button data-role="button" id="setSchedule">
                    Set new schedule
                </button>
            </li>
        </ul>
        <ul data-role="listview" data-divider-theme="c" data-inset="false">
            <li data-role="list-divider" role="heading">
                Active Schedules
            </li>
            <li data-theme="c">
                <div class="ui-grid-a">
                    <div class="ui-block-a">
                        <h3 style="text-align:center">
                            Time 1
                        </h3>
                    </div>
                    <div class="ui-block-b">
                        <div data-role="fieldcontain" data-controltype="toggleswitch" data-theme="c">
                            <select name="toggleswitch1" id="toggleswitch1" data-theme="c" data-role="slider"
                                    data-mini="true" data-theme="c">
                                <option value="off">
                                    Off
                                </option>
                                <option value="on">
                                    On
                                </option>
                            </select>
                        </div>
                    </div>
                </div>
            </li>
            <li data-theme="c">
                <div class="ui-grid-a">
                    <div class="ui-block-a">
                        <h3 style="text-align:center">
                            Time 2
                        </h3>
                    </div>
                    <div class="ui-block-b">
                        <div data-role="fieldcontain" data-controltype="toggleswitch" data-theme="c">
                            <select name="toggleswitch1" id="toggleswitch1" data-theme="c" data-role="slider"
                                    data-mini="true" data-theme="c">
                                <option value="off">
                                    Off
                                </option>
                                <option value="on">
                                    On
                                </option>
                            </select>
                        </div>
                    </div>
                </div>
            </li>
            <li data-theme="c">
                <div class="ui-grid-a">
                    <div class="ui-block-a">
                        <h3 style="text-align:center">
                            Time 3
                        </h3>
                    </div>
                    <div class="ui-block-b">
                        <div data-role="fieldcontain" data-controltype="toggleswitch" data-theme="c">
                            <select name="toggleswitch1" id="toggleswitch1" data-theme="c" data-role="slider"
                                    data-mini="true" data-theme="c">
                                <option value="off">
                                    Off
                                </option>
                                <option value="on">
                                    On
                                </option>
                            </select>
                        </div>
                    </div>
                </div>
            </li>
        </ul>
        <ul data-role="listview" data-divider-theme="c" data-inset="false">
            <li data-role="list-divider" role="heading">
                Distance Settings
            </li>
            <li data-theme="c">
                <div class="ui-grid-a">
                    <div class="ui-block-a" style="margin:auto">
                        <h3 style="text-align:center">
                            Distance Control
                        </h3>
                    </div>
                    <div class="ui-block-b">
                        <div data-role="fieldcontain" data-controltype="toggleswitch" data-theme="c">
                            <select name="toggleswitch1" id="tsDControl" data-theme="c" data-role="slider"
                                    data-mini="true" data-theme="c">
                                <option value="off">
                                    Off
                                </option>
                                <option value="on" selected>
                                    On
                                </option>
                            </select>
                        </div>
                    </div>
                </div>
            </li>
            <div id="distance_group">
                <li data-theme="c">
                    <div class="ui-grid-a">
                        <div class="ui-block-a" style="margin:auto">
                            <h3 style="text-align:center">
                                Turn this device
                            </h3>
                        </div>
                        <div class="ui-block-b">
                            <div data-role="fieldcontain" data-controltype="toggleswitch" data-theme="c">
                                <select name="toggleswitch1" id="toggleswitch1" data-theme="c" data-role="slider"
                                        data-mini="true" data-theme="c">
                                    <option value="0">
                                        Off
                                    </option>
                                    <option value="1" selected>
                                        On
                                    </option>
                                </select>
                            </div>
                        </div>
                    </div>
                </li>
            <div class="ui-grid-b" data-theme="c">
                <div class="ui-block-a" data-theme="c">
                    <h4>
                        When I am
                    </h4>
                </div>
                <div class="ui-block-b" data-theme="c">
                    <div data-role="fieldcontain" data-controltype="textinput">
                        <input name="" id="textinput1" placeholder="" value="" type="number" data-mini="true">
                    </div>
                </div>
                <div class="ui-block-c" data-theme="c" id="">
                    <h4 style="text-align:center">
                        miles away
                    </h4>
                </div>
            </div>
            <a data-role="button" href="#page4" data-theme="c">
                Save
            </a>
        </div>
    </div>
    <div data-theme="c" data-role="footer">
        <h3>
            UW-Madison
        </h3>
    </div>
</div>



<div data-role="page" data-control-title="Home" id="time_scheduler" data-theme="c">
    <div data-theme="c" data-role="header" id="header">
        <button data-role="button" data-inline="true" class="ui-btn-left" id="btnBacktoSensorSettings">
            Back
        </button>
        <h3>
            Set Schedule
        </h3>
    </div>
    <div data-role="content" data-theme="c">
        <div class="ui-grid-a" data-theme="c">
            <div class="ui-block-a" data-theme="c">
                <h3>
                    Set this device
                </h3>
            </div>
            <div class="ui-block-b" data-theme="c">
                <div data-role="fieldcontain" data-controltype="toggleswitch" data-theme="c">
                    <select name="toggleswitch1" id="device_state" data-theme="c" data-role="slider"
                    data-mini="true" data-theme="c">
                        <option value="0">
                            Off
                        </option>
                        <option value="1">
                            On
                        </option>
                    </select>
                </div>
            </div>
        </div>
        <h2>
            At this time
        </h2>
        <div class="ui-grid-a" data-theme="c">
            <div class="ui-block-a" data-theme="c">
                <div data-role="fieldcontain" data-controltype="dateinput" data-theme="c">
                    <input name="" id="time" placeholder="" value="" type="time">
                </div>
            </div>
<!--             <div class="ui-block-b" data-theme="c">
                <a data-role="button" href="#page1" data-icon="plus" data-iconpos="notext" data-theme="c">
                </a>
            </div> -->
        </div>
        <h2>
            Each week repeating on
        </h2>
        <div id="checkboxes2" data-role="fieldcontain" data-controltype="checkboxes" data-theme="c">
            <fieldset data-role="controlgroup" data-type="vertical" data-theme="c">
                <input id="sunday" name="" type="checkbox">
                    <label for="sunday">
                        Sunday
                    </label>
                <input id="monday" name="" type="checkbox">
                    <label for="monday">
                        Monday
                    </label>
                <input id="tuesday" name="" type="checkbox">
                    <label for="tuesday">
                        Tuesday
                    </label>
                <input id="wednesday" name="" type="checkbox">
                    <label for="wednesday">
                        Wednesday
                    </label>
                <input id="thursday" name="" type="checkbox">
                    <label for="thursday">
                        Thursday
                    </label>
                <input id="friday" name="" type="checkbox">
                    <label for="friday">
                        Friday
                    </label>
                <input id="saturday" name="" type="checkbox">
                    <label for="saturday">
                        Saturday
                    </label>
            </fieldset>
        </div>
        <button id="btnSaveSchedule" data-role="button" href="#page1" data-theme="c">
            Save
        </button>
    </div>
    <div data-theme="c" data-role="footer" data-position="fixed">
        <h3>
            UW-Madison
        </h3>
    </div>
</div>



</body>








<script>


$("#loginBtn").click(function (e) {
    e.preventDefault()

    var e = $("#email").val();
    var p = $("#password").val();


$.ajax({
      url: "http://studioxps.wings.cs.wisc.edu/digitalnetworkdevices/includes/process_login_mobile.php",
      type: "post",
      data: {'email': e,'p':p},
  datatype: 'json',
      success: function(data){

        console.log(data);


        data = $.trim(data);
        data = data.replace(/['"]+/g, '');

        if(data == "Failure"){
            alert("Incorrect Login: Please Try Again.");
            return;
        }

        data = parseInt(data);




        if(typeof(data) == "number"){
            localStorage.setItem('user_id',data)
            localStorage.setItem('loggedin','true')

            $(':mobile-pagecontainer').pagecontainer('change', '#devices', {
            transition: 'slide',
            changeHash: false,
            showLoadMsg: true

            });


        }else{
            localStorage.setItem('loggedin','false')
            console.log(data);
        }
         
      },
      error: function(error) {
        alert((error.responseText));
}
    });

$(document).on("pagecreate", "#devices", function( event ) {

        var id = localStorage.getItem("user_id");

        $.ajax({
        url: "http://studioxps.wings.cs.wisc.edu/digitalnetworkdevices/includes/get_devices_mobile.php",
        type: "post", 
        data: {'id': id},
        dataType: "json",
        success: function(data){
            var devices = data;
            console.log(data);

            for(var i = 0; i < devices.length; i++)
            {

                $('#sensor_list').append('<li data-theme="c"><button data-role="button" onClick="return scheduler(this);" id='+devices[i].sensor_id+' data-theme="c">Sensor ID: '+devices[i].sensor_id+' Device Name: '+devices[i].name+'</button></li>');
                
            }


            $('#sensor_list').trigger('create');

             
        },
        
        error: function(error) {
            console.log(error.responseText);
        }
        
        });
    

});

});


$("#btnSensors").click(function (e) {

                $(':mobile-pagecontainer').pagecontainer('change', '#sensor_settings', {
            transition: 'slide',
            changeHash: false,
            showLoadMsg: true

            });

});

$("#btnLogout").click(function (e) {

                $(':mobile-pagecontainer').pagecontainer('change', '#loginPage', {
            transition: 'slide',
            changeHash: false,
            reverse: true,
            showLoadMsg: true

            });

});

$("#btnBacktoDevices").click(function (e) {

                $(':mobile-pagecontainer').pagecontainer('change', '#devices', {
            transition: 'slide',
            changeHash: false,
            reverse: true,
            showLoadMsg: true

            });

});

$("#btnBacktoSensorSettings").click(function (e) {

                $(':mobile-pagecontainer').pagecontainer('change', '#sensor_settings', {
            transition: 'slide',
            changeHash: false,
            reverse: true,
            showLoadMsg: true

            });

});

$("#setSchedule").click(function (e) {

                $(':mobile-pagecontainer').pagecontainer('change', '#time_scheduler', {
            transition: 'slide',
            changeHash: false,
            showLoadMsg: true

            });

});

$("#btnSaveSchedule").click(function (e) {

    var sensor_id = localStorage.getItem('sensor_id');
    var device_state = parseInt($('#device_state').val());
    var time = $('#device_state').val();
    var sunday = $('#sunday').is(":checked");;
    alert(sunday);
    alert(time);
    // var monday
    // var tuesday
    // var wednesday
    // var thursday
    // var friday
    // var saturday
    // var time
    // var schedule_state = 1;

});



$( "#tsDControl" ).on( "slidestop", function(event, ui) {
  
  //Get boolean of whether or not slide toggle is on for distance control
  var bDControl = $("#tsDControl").val();

  //If off, hide settings below
  if(bDControl == "off")
  {
    $( "#distance_group" ).hide();
  } 
  else
  {
    $( "#distance_group" ).show();
  }

});

// $(document).on("pagecreate", "#sensor_settings", function( event ) {

//     var sensor_id = localStorage.getItem('sensor_id');

// });

// $(document).on("pagecreate", "#sensor_settings", function( event ) {

    

// });

function scheduler(sensor){
        var sensor_id = sensor.id;
        alert(sensor_id);
        localStorage.setItem('sensor_id',sensor_id);
        $(':mobile-pagecontainer').pagecontainer('change', '#sensor_settings', {
            transition: 'slide',
            changeHash: false,
            showLoadMsg: true

            });
}

</script> 
</html>
