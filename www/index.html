        <html>

        <head>
            <meta charset="utf-8" />
                <meta name="format-detection" content="telephone=no" />
                <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
               <meta name="viewport" content="user-scalable=no, initial-scale=1, minimum-scale=1, width=device-width" />
                <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.1/jquery.mobile-1.4.1.min.css"/>
                <link rel="stylesheet" href="css/index.css">
                <link rel="stylesheet" href="css/custom.css">
                <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
                <script src="http://code.jquery.com/mobile/1.4.1/jquery.mobile-1.4.1.min.js"></script>
                <script src="http://maps.googleapis.com/maps/api/js?sensor=true"></script>
                <script src="http://www.parsecdn.com/js/parse-1.2.18.min.js"></script>
        </head>

        <body> 
            
        <div id="loginPage" data-role="page" data-theme="c">

            <div data-theme="c" data-role="header" id="header">
                        <strong id="WINGS">WINGS-Energy Control</strong>
                        <img src="img/router.png">
             </div>

            <div data-role="content" data-theme="c">    

                <form id="loginForm" data-theme="c">
                <div data-role="fieldcontain" class="ui-hide-label" data-theme="c">
                    <label for="email">Email:</label>
                    <input type="text" name="email" id="email" value="" placeholder="Email" />
                </div>

                <div data-role="fieldcontain" class="ui-hide-label" data-theme="c"> 
                    <label for="password">Password:</label>
                    <input type="password" name="password" id="password" value="" placeholder="Password" />
                </div>

                </form>
                <button data-role="button" id="loginBtn" data-theme="c">Login</button>
            </div>

            <div data-theme="c" data-role="footer">
                        <h3>
                            UW-Madison
                        </h3>
                    </div>
        </div>

        <div data-role="page" data-control-title="Routers" id="devices" data-theme="c">
            <div data-theme="c" data-role="header" id="header">
                <button data-role="button" data-inline="true" class="ui-btn-left" id="btnLogout">
                    Logout
                </button>
                <h5>
                    Energy Control
                </h5>
            </div>
            <div data-role="content" data-theme="c">
                <ul id="sensor_list" data-role="listview" data-divider-theme="c" data-inset="false">
                    <li data-theme="c">
                    </li>
                </ul>
            </div>
            <div data-theme="c" data-role="footer">
                <h3>
                    UW-Madison
                </h3>
            </div>
        </div>

        <div data-role="page" data-control-title="Routers" id="sensor_settings" data-theme="c">
            <div data-theme="c" data-role="header" id="header">
                <button data-role="button" data-inline="true" class="ui-btn-left" id="btnBacktoDevices">
                    Back
                </button>
                <h5>
                    Sensor Settings
                </h5>
            </div>
            <div data-role="content" data-theme="c">
                <ul data-role="listview" data-divider-theme="c" data-inset="false" id="set_sched">
                    <li data-theme="c">
                        <div class="ui-grid-a">
                            <div class="ui-block-a">
                                <h3 style="text-align:center">
                                    Device State
                                </h3>
                            </div>
                            <div class="ui-block-b">
                                <div data-role="fieldcontain" data-controltype="toggleswitch" data-theme="c">
                                    <select name="toggleswitch1" id="toggleswitch1" data-theme="c" data-role="slider"
                                            data-mini="true" data-theme="c">
                                        <option value="off">
                                            Off
                                        </option>
                                        <option value="on">
                                            On
                                        </option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </li>
                    <li data-theme="c">
                        <button data-role="button" id="setSchedule">
                            Set new schedule
                        </button>
                    </li>
                </ul>
                <ul data-role="listview" id="schedule_list" data-divider-theme="c" data-inset="false">
                    
                </ul>
                </div>
            </div>
            <div data-theme="c" data-role="footer">
                <h3>
                    UW-Madison
                </h3>
            </div>
        </div>



        <div data-role="page" data-control-title="Home" id="time_scheduler" data-theme="c">
            <div data-theme="c" data-role="header" id="header">
                <button data-role="button" data-inline="true" class="ui-btn-left" id="btnBacktoSensorSettings">
                    Back
                </button>
                <h3>
                    Set Schedule
                </h3>
            </div>
            <div data-role="content" data-theme="c">
                <div class="ui-grid-a" data-theme="c">
                    <div class="ui-block-a" data-theme="c">
                        <h3>
                            Set this device
                        </h3>
                    </div>
                    <div class="ui-block-b" data-theme="c">
                        <div data-role="fieldcontain" data-controltype="toggleswitch" data-theme="c">
                            <select name="toggleswitch1" id="device_state" data-theme="c" data-role="slider"
                            data-mini="true" data-theme="c">
                                <option value="0">
                                    Off
                                </option>
                                <option value="1">
                                    On
                                </option>
                            </select>
                        </div>
                    </div>
                </div>
                <h2>
                    At this time
                </h2>
                <div class="ui-grid-a" data-theme="c">
                    <div class="ui-block-a" data-theme="c">
                        <div data-role="fieldcontain" data-controltype="dateinput" data-theme="c">
                            <input name="" id="time" placeholder="" value="" type="time">
                        </div>
                    </div>
        <!--             <div class="ui-block-b" data-theme="c">
                        <a data-role="button" href="#page1" data-icon="plus" data-iconpos="notext" data-theme="c">
                        </a>
                    </div> -->
                </div>
                <h2>
                    Each week repeating on
                </h2>
                <div id="checkboxes2" data-role="fieldcontain" data-controltype="checkboxes" data-theme="c">
                    <fieldset data-role="controlgroup" data-type="vertical" data-theme="c">
                        <input id="sunday" name="" type="checkbox">
                            <label for="sunday">
                                Sunday
                            </label>
                        <input id="monday" name="" type="checkbox">
                            <label for="monday">
                                Monday
                            </label>
                        <input id="tuesday" name="" type="checkbox">
                            <label for="tuesday">
                                Tuesday
                            </label>
                        <input id="wednesday" name="" type="checkbox">
                            <label for="wednesday">
                                Wednesday
                            </label>
                        <input id="thursday" name="" type="checkbox">
                            <label for="thursday">
                                Thursday
                            </label>
                        <input id="friday" name="" type="checkbox">
                            <label for="friday">
                                Friday
                            </label>
                        <input id="saturday" name="" type="checkbox">
                            <label for="saturday">
                                Saturday
                            </label>
                    </fieldset>
                </div>
                <button id="btnSaveSchedule" data-role="button" href="#page1" data-theme="c">
                    Save
                </button>
            </div>
            <div data-theme="c" data-role="footer" data-position="fixed">
                <h3>
                    UW-Madison
                </h3>
            </div>
        </div>



        </body>








        <script>


        $("#loginBtn").click(function (e) {
            e.preventDefault();

            var e = $("#email").val();
            var p = $("#password").val();


        $.ajax({
              url: "http://studioxps.wings.cs.wisc.edu/digitalnetworkdevices/includes/process_login_mobile.php",
              type: "post",
              data: {'email': e,'p':p},
          datatype: 'json',
              success: function(data){

                console.log(data);


                data = $.trim(data);
                data = data.replace(/['"]+/g, '');

                if(data == "Failure"){
                    alert("Incorrect Login: Please Try Again.");
                    return;
                }

                data = parseInt(data);




                if(typeof(data) == "number"){
                    localStorage.setItem('user_id',data)
                    localStorage.setItem('loggedin','true')

                    $(':mobile-pagecontainer').pagecontainer('change', '#devices', {
                    transition: 'slide',
                    changeHash: false,
                    showLoadMsg: true

                    });


                }else{
                    localStorage.setItem('loggedin','false')
                    console.log(data);
                }
                 
              },
              error: function(error) {
                alert((error.responseText));
                return;
        }
            });

        
            

        });

    $(document).on("pageshow", "#devices", function( event ) {

                
                var id = localStorage.getItem("user_id");

                $.ajax({
                url: "http://studioxps.wings.cs.wisc.edu/digitalnetworkdevices/includes/get_devices_mobile.php",
                type: "post", 
                data: {'id': id},
                dataType: "json",
                success: function(data){
                    var devices = data;
                    console.log(data);

                    for(var i = 0; i < devices.length; i++)
                    {

                        $('#sensor_list').append('<li data-theme="c"><button data-role="button" onClick="return scheduler(this);" id='+devices[i].sensor_id+' data-theme="c">Sensor ID: '+devices[i].sensor_id+' Device Name: '+devices[i].name+'</button></li>');
                        
                    }


                    $('#sensor_list').trigger('create');

                     
                },
                
                error: function(error) {
                    console.log(error.responseText);
                }
                
                });
            });

        $(document).on("pageshow", "#sensor_settings", function( event ) {
                var sensor_id = localStorage.getItem("sensor_id");
                

                $('#schedule_list').append('<div><li data-role="list-divider" role="heading"><h3 style="text-align:center">Active Schedules</h3></li></div>');

                $('#schedule_list').trigger('create');

                // <li data-theme="c"><div class="ui-grid-a"><div class="ui-block-a"><h3 style="text-align:center">'+newTime+'<br><span style="color: '+weekColors[0]+'">Su</span> <span style="color: '+weekColors[1]+'">M</span> <span style="color: '+weekColors[2]+'">T</span> <span style="color: '+weekColors[3]+'">W</span> <span style="color: '+weekColors[4]+'">Tr</span> <span style="color: '+weekColors[5]+'">Fr</span> <span style="color: '+weekColors[6]+'">Sa</span></h3></div><div class="ui-block-b"><div data-role="fieldcontain" data-controltype="toggleswitch" data-theme="c"><select name="toggleswitch1" id="toggleswitch1" data-theme="c" data-role="slider"data-mini="true" data-theme="c"><option value="off">Off</option><option value="on">On</option></select></div></div></div></li>'

                $.ajax({
                url: "http://studioxps.wings.cs.wisc.edu/digitalnetworkdevices/includes/get_schedules.php",
                type: "post", 
                data: {'sensor_id': sensor_id},
                dataType: "json",
                success: function(data){
                    var schedules = data;
                    console.log(data);
                    var newTime;
                    for(var i = 0; i < schedules.length; i++)
                    {
                        newTime = ""
                        var parts = schedules[i].time.split(':'),
                            hour = parts[0],
                            minutes = parts[1];

                        if (hour > 12) {
                            newTime = (hour - 12) + ':' + minutes + ' pm';
                        } else if (hour == 0) {
                            console.log("hour == 0 test" + hour);
                            newTime = 12 + ':' + minutes + ' am';
                        } else if (hour == 12) {
                            newTime = 12 + ':' + minutes;
                            newTime += ' pm';
                        } else {
                            newTime = parseInt(hour) + ":" + minutes;
                            newTime += ' am';
                        }

                        var weekColors = []
                        if(data[i].sunday == 1){
                            weekColors[0] = "cornflowerblue";
                        }else{
                            weekColors[0] = "grey";
                        }

                        if(data[i].monday == 1){
                            weekColors[1] = "cornflowerblue";
                        }else{
                            weekColors[1] = "grey";
                        }

                        if(data[i].tuesday == 1){
                            weekColors[2] = "cornflowerblue";
                        }else{
                            weekColors[2] = "grey";
                        }

                        if(data[i].wednesday == 1){
                            weekColors[3] = "cornflowerblue";
                        }else{
                            weekColors[3] = "grey";
                        }

                        if(data[i].thursday == 1){
                            weekColors[4] = "cornflowerblue";
                        }else{
                            weekColors[4] = "grey";
                        }

                        if(data[i].friday == 1){
                            weekColors[5] = "cornflowerblue";
                        }else{
                            weekColors[5] = "grey";
                        }

                        if(data[i].saturday == 1){
                            weekColors[6] = "cornflowerblue";
                        }else{
                            weekColors[6] = "grey";
                        }




                        $('#schedule_list').append('<li data-theme="c"><div class="ui-block-a" style="width:40%"><h3 style="text-align:center">'+newTime+'<br><span style="color: '+weekColors[0]+'">Su</span> <span style="color: '+weekColors[1]+'">M</span> <span style="color: '+weekColors[2]+'">T</span> <span style="color: '+weekColors[3]+'">W</span> <span style="color: '+weekColors[4]+'">Tr</span> <span style="color: '+weekColors[5]+'">Fr</span> <span style="color: '+weekColors[6]+'">Sa</span></h3></div><div class="ui-block-b" style="width:25%"><div data-role="fieldcontain" data-controltype="toggleswitch" data-theme="c"><select name="toggleswitch1" id="toggleswitch1" data-theme="c" data-role="slider"data-mini="true" data-theme="c"><option value="off">Off</option><option value="on">On</option></select></div></div><div class="ui-block-c"><button data-role="button" data-icon="delete" id='+data[i].schedule_id+' onClick="return delete_schedule(this);" data-iconpos="notext">Delete</button></div></li>');
                        

                    }


                    $('#schedule_list').trigger('create');

                     
                },
                
                error: function(error) {
                    console.log(error.responseText);
                }
                
                });
            

        });




        $("#btnSensors").click(function (e) {
                $('#sensor_list').empty();
                $('#sensor_list').trigger('create');
                        $(':mobile-pagecontainer').pagecontainer('change', '#sensor_settings', {
                    transition: 'slide',
                    changeHash: false,
                    showLoadMsg: true

                    });

        });

        $("#btnLogout").click(function (e) {
            $('#sensor_list').empty();
                $('#sensor_list').trigger('create');

                        $(':mobile-pagecontainer').pagecontainer('change', '#loginPage', {
                    transition: 'slide',
                    changeHash: false,
                    reverse: true,
                    showLoadMsg: true

                    });

        });

        $("#btnBacktoDevices").click(function (e) {
                $('#schedule_list').empty();
                $('#schedule_list').trigger('create');
                        $(':mobile-pagecontainer').pagecontainer('change', '#devices', {
                    transition: 'slide',
                    changeHash: false,
                    reverse: true,
                    showLoadMsg: true

                    });

        });

        $("#btnBacktoSensorSettings").click(function (e) {

                        $(':mobile-pagecontainer').pagecontainer('change', '#sensor_settings', {
                    transition: 'slide',
                    changeHash: false,
                    reverse: true,
                    showLoadMsg: true

                    });

        });

        $("#setSchedule").click(function (e) {


            $('#schedule_list').empty();
                $('#schedule_list').trigger('create');



                        $(':mobile-pagecontainer').pagecontainer('change', '#time_scheduler', {
                    transition: 'slide',
                    changeHash: false,
                    showLoadMsg: true

                    });

        });

        $("#btnSaveSchedule").click(function (e) {

            var sensor_id = localStorage.getItem('sensor_id');
            var time = $('#time').val();
            var device_state = parseInt($('#device_state').val());
            var schedule_state = 1;
            var sunday = $('#sunday').is(":checked") ? 1: 0;
            var monday = $('#monday').is(":checked") ? 1: 0;
            var tuesday = $('#tuesday').is(":checked") ? 1: 0;
            var wednesday = $('#wednesday').is(":checked") ? 1: 0;
            var thursday = $('#thursday').is(":checked") ? 1: 0;
            var friday = $('#friday').is(":checked") ? 1: 0;
            var saturday = $('#saturday').is(":checked") ? 1: 0;

            if(time == "")
            {
                alert("Please make sure to enter a value for the time field");
                return;
            }

            var schedule_data = {"sensor_id": sensor_id,
                        "time": time,
                        "device_state": device_state,
                        "schedule_state": schedule_state,
                        "sunday": sunday,
                        "monday": monday,
                        "tuesday": tuesday,
                        "wednesday": wednesday,
                        "thursday": thursday,
                        "friday": friday,
                        "saturday": saturday
                        };

                        alert(time);

             $.ajax({
                url: "http://studioxps.wings.cs.wisc.edu/digitalnetworkdevices/includes/set_schedules.php",
                type: "post", 
                data: schedule_data,
                dataType: "json",
                success: function(data){
                   console.log(data);

                     
                },
                
                error: function(error) {
                    console.log(error);
                    console.log(error.responseText);
                }
                
                });

             $(':mobile-pagecontainer').pagecontainer('change', '#sensor_settings', {
                    transition: 'slide',
                    changeHash: false,
                    reverse: true,
                    showLoadMsg: true

                    });



        });


        function scheduler(sensor){
            $('#sensor_list').empty();
                $('#sensor_list').trigger('create');
                var sensor_id = sensor.id;
                localStorage.setItem('sensor_id',sensor_id);
                $(':mobile-pagecontainer').pagecontainer('change', '#sensor_settings', {
                    transition: 'slide',
                    changeHash: false,
                    showLoadMsg: true

                    });
        }

        function delete_schedule(schedule){


                console.log(schedule);
                var id = schedule.id;
                console.log(id);
                var sensor_id = localStorage.getItem('sensor_id');

                

                $.ajax({
                url: "http://studioxps.wings.cs.wisc.edu/digitalnetworkdevices/includes/delete_schedules.php",
                type: "post", 
                data: {'schedule_id': id},
                dataType: "json",
                success: function(data){
                    console.log(data);
                     
                },
                
                error: function(error) {
                    console.log(error);
                }
                
                });
                

                $('#schedule_list').empty();

                $.ajax({
                url: "http://studioxps.wings.cs.wisc.edu/digitalnetworkdevices/includes/get_schedules.php",
                type: "post", 
                data: {'sensor_id': sensor_id},
                dataType: "json",
                success: function(data){
                    var schedules = data;
                    console.log(data);
                    var newTime;
                    for(var i = 0; i < schedules.length; i++)
                    {
                        newTime = ""
                        var parts = schedules[i].time.split(':'),
                            hour = parts[0],
                            minutes = parts[1];

                        if (hour > 12) {
                            newTime = (hour - 12) + ':' + minutes + ' pm';
                        } else if (hour == 0) {
                            console.log("hour == 0 test" + hour);
                            newTime = 12 + ':' + minutes + ' am';
                        } else if (hour == 12) {
                            newTime = 12 + ':' + minutes;
                            newTime += ' pm';
                        } else {
                            newTime = parseInt(hour) + ":" + minutes;
                            newTime += ' am';
                        }

                        var weekColors = []
                        if(data[i].sunday == 1){
                            weekColors[0] = "cornflowerblue";
                        }else{
                            weekColors[0] = "grey";
                        }

                        if(data[i].monday == 1){
                            weekColors[1] = "cornflowerblue";
                        }else{
                            weekColors[1] = "grey";
                        }

                        if(data[i].tuesday == 1){
                            weekColors[2] = "cornflowerblue";
                        }else{
                            weekColors[2] = "grey";
                        }

                        if(data[i].wednesday == 1){
                            weekColors[3] = "cornflowerblue";
                        }else{
                            weekColors[3] = "grey";
                        }

                        if(data[i].thursday == 1){
                            weekColors[4] = "cornflowerblue";
                        }else{
                            weekColors[4] = "grey";
                        }

                        if(data[i].friday == 1){
                            weekColors[5] = "cornflowerblue";
                        }else{
                            weekColors[5] = "grey";
                        }

                        if(data[i].saturday == 1){
                            weekColors[6] = "cornflowerblue";
                        }else{
                            weekColors[6] = "grey";
                        }




                        $('#schedule_list').append('<li data-theme="c"><div class="ui-block-a" style="width:40%"><h3 style="text-align:center">'+newTime+'<br><span style="color: '+weekColors[0]+'">Su</span> <span style="color: '+weekColors[1]+'">M</span> <span style="color: '+weekColors[2]+'">T</span> <span style="color: '+weekColors[3]+'">W</span> <span style="color: '+weekColors[4]+'">Tr</span> <span style="color: '+weekColors[5]+'">Fr</span> <span style="color: '+weekColors[6]+'">Sa</span></h3></div><div class="ui-block-b" style="width:25%"><div data-role="fieldcontain" data-controltype="toggleswitch" data-theme="c"><select name="toggleswitch1" id="toggleswitch1" data-theme="c" data-role="slider"data-mini="true" data-theme="c"><option value="off">Off</option><option value="on">On</option></select></div></div><div class="ui-block-c"><button data-role="button" id='+data[i].schedule_id+' data-icon="delete" onClick="return delete_schedule(this);" data-iconpos="notext">Delete</button></div></li>');
                        

                    }


                    $('#schedule_list').trigger('create');

                     
                },
                
                error: function(error) {
                    console.log(error.responseText);
                }
                
                });

        $('.slider').on('slidestart', function(){    
             console.log('Start');
        });

        $( ".slider" ).on( 'slidestop', function( event ) {alert("TEST"); });

        $( ".slider" ).slider({
          stop: function( event, ui ) {alert("TEST");}
        });

         $('.slider').on('slidestop', function(){   
            alert("TEST");
        });
        function toggle(state){
            alert("test");
        }

        $('#OnFront').on('slidestart', function(){    
             console.log('Start');
        });

        $( ".slider" ).on( 'slidestop', function( event ) {alert("TEST"); });

        $( ".slider" ).slider({
          stop: function( event, ui ) {alert("TEST");}
        });

         $('.slider').on('slidestop', function(){   
            alert("TEST");
        });
        function toggle(state){
            alert("test");
        }


        }




        </script> 
        </html>
